{{/* 
  Reusable Contact Form Component
  Parameters:
  - .title: Form title
  - .description: Form description
  - .pageName: Name of the page where form is displayed (for tracking)
  - .compact: Boolean for compact layout (optional)
*/}}

{{ $title := .title | default (i18n "quick_contact_title") }}
{{ $description := .description | default (i18n "quick_contact_text") }}
{{ $pageName := .pageName | default "Unknown Page" }}
{{ $compact := .compact | default false }}

<div class="contact-form-wrapper {{ if $compact }}compact{{ end }}">
  <div class="max-w-lg mx-auto">
    {{ if not $compact }}
    <div class="text-center mb-8">
      <h3 class="text-2xl font-bold text-gray-900 mb-3">{{ $title }}</h3>
      <p class="text-gray-600">{{ $description }}</p>
    </div>
    {{ end }}

    <!-- AJAX Feedback Area -->
    <div id="quick-form-feedback-{{ $pageName | urlize }}" class="mb-6 hidden" role="status" aria-live="polite">
      <div id="quick-form-success-{{ $pageName | urlize }}"
        class="hidden bg-green-50 border border-green-200 text-green-800 px-6 py-4 rounded-xl">
        <div class="flex items-center gap-3">
          <i class="fas fa-check-circle"></i>
          <p class="font-medium">{{ i18n "contact_success_message" }}</p>
        </div>
      </div>

      <div id="quick-form-error-{{ $pageName | urlize }}"
        class="hidden bg-red-50 border border-red-200 text-red-800 px-6 py-4 rounded-xl">
        <div class="flex items-center gap-3">
          <i class="fas fa-exclamation-circle"></i>
          <p class="font-medium">{{ i18n "contact_error_message" }}</p>
        </div>
      </div>
    </div>

    <!-- Contact Form -->
    <form id="quick-contact-{{ $pageName | urlize }}" 
          class="quick-contact-form space-y-4"
          action="https://api.web3forms.com/submit" 
          method="POST">
      
      <!-- Web3Forms Access Key -->
      <input type="hidden" name="access_key" value="bec4456c-9b97-4528-b493-1189ef3d3969">
      <input type="hidden" name="subject" value="Quick Contact Form - Baseet Studio">
      <input type="hidden" name="page" value="{{ $pageName }}">
      <input type="hidden" name="language" value="{{ site.Language.Lang }}">
      
      <!-- Name -->
      <div>
        <label for="quick-name-{{ $pageName | urlize }}" class="block text-sm font-medium text-gray-700 mb-2">
          {{ i18n "contact_name_label" }} <span class="text-red-500">*</span>
        </label>
        <input type="text" 
               id="quick-name-{{ $pageName | urlize }}" 
               name="name" 
               required
               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#496BC1] focus:border-transparent transition-all duration-200 outline-none"
               placeholder="{{ i18n "contact_name_placeholder" }}">
      </div>
      
      <!-- Email -->
      <div>
        <label for="quick-email-{{ $pageName | urlize }}" class="block text-sm font-medium text-gray-700 mb-2">
          {{ i18n "contact_email_label" }} <span class="text-red-500">*</span>
        </label>
        <input type="email" 
               id="quick-email-{{ $pageName | urlize }}" 
               name="email" 
               required
               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#496BC1] focus:border-transparent transition-all duration-200 outline-none"
               placeholder="{{ i18n "contact_email_placeholder" }}">
      </div>
      
      <!-- Phone (optional) -->
      <div>
        <label for="quick-phone-{{ $pageName | urlize }}" class="block text-sm font-medium text-gray-700 mb-2">
          {{ i18n "contact_phone_label" }}
        </label>
        <input type="tel" 
               id="quick-phone-{{ $pageName | urlize }}" 
               name="phone"
               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#496BC1] focus:border-transparent transition-all duration-200 outline-none"
               placeholder="{{ i18n "contact_phone_placeholder" }}">
      </div>
      
      <!-- Message -->
      <div>
        <label for="quick-message-{{ $pageName | urlize }}" class="block text-sm font-medium text-gray-700 mb-2">
          {{ i18n "contact_message_label" }} <span class="text-red-500">*</span>
        </label>
        <textarea id="quick-message-{{ $pageName | urlize }}" 
                  name="message" 
                  rows="4" 
                  required
                  class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#496BC1] focus:border-transparent transition-all duration-200 outline-none resize-none"
                  placeholder="{{ i18n "contact_message_placeholder" }}"></textarea>
      </div>
      
      <!-- Submit Button -->
      <button type="submit"
        class="w-full py-4 px-6 bg-gradient-to-r from-[#496BC1] to-[#3a5aa3] text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-[#496BC1]/25 transform hover:-translate-y-0.5 transition-all duration-300 flex items-center justify-center gap-2">
        <span class="btn-text">{{ i18n "contact_submit_btn" }}</span>
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
  </div>
</div>

<script>
(function() {
  'use strict'
  
  const formId = 'quick-contact-{{ $pageName | urlize }}'
  const form = document.getElementById(formId)
  
  if (!form) return
  
  form.addEventListener('submit', async function(event) {
    event.preventDefault()
    
    const formData = new FormData(form)
    const submitBtn = form.querySelector('button[type="submit"]')
    const btnText = submitBtn.querySelector('.btn-text')
    const originalText = btnText.textContent
    const feedbackContainer = document.getElementById('quick-form-feedback-{{ $pageName | urlize }}')
    const successMessage = document.getElementById('quick-form-success-{{ $pageName | urlize }}')
    const errorMessage = document.getElementById('quick-form-error-{{ $pageName | urlize }}')
    
    // Set loading state
    submitBtn.disabled = true
    btnText.textContent = '{{ i18n "sending" | default "Sending..." }}'
    feedbackContainer.classList.add('hidden')
    successMessage.classList.add('hidden')
    errorMessage.classList.add('hidden')
    
    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      
      if (response.ok) {
        // Show success
        feedbackContainer.classList.remove('hidden')
        successMessage.classList.remove('hidden')
        form.reset()
        
        // Scroll to feedback
        feedbackContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
        
        // Auto-hide after 8 seconds
        setTimeout(() => {
          successMessage.classList.add('hidden')
          feedbackContainer.classList.add('hidden')
        }, 8000)
      } else {
        // Show error
        feedbackContainer.classList.remove('hidden')
        errorMessage.classList.remove('hidden')
        
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
        
        setTimeout(() => {
          errorMessage.classList.add('hidden')
          feedbackContainer.classList.add('hidden')
        }, 10000)
      }
    } catch (error) {
      // Network error
      feedbackContainer.classList.remove('hidden')
      errorMessage.classList.remove('hidden')
      
      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
      
      setTimeout(() => {
        errorMessage.classList.add('hidden')
        feedbackContainer.classList.add('hidden')
      }, 10000)
    } finally {
      // Reset button
      submitBtn.disabled = false
      btnText.textContent = originalText
    }
  })
})()
</script>
