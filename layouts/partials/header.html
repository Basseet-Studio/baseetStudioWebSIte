<!-- Skip to content for keyboard users -->
<a href="#mainContent" class="skip-to-content">{{ i18n "skip_to_content" }}</a>

<header id="app-bar" class="app-bar" role="banner" {{ if eq .Site.Language.LanguageDirection "rtl" }}dir="rtl"{{ end }}>
    <div class="app-bar-container">
        <!-- Logo -->
        <a href="{{ "/" | relLangURL }}" class="app-bar-logo logo-premium" aria-label="{{ i18n "aria_home_link" }}">
            <span class="logo-text">{{ i18n "logo_text" }}</span>
        </a>

        <!-- Desktop Navigation -->
        <nav class="app-bar-nav" aria-label="Main navigation">
            <ul class="nav-links">
                {{ range site.Menus.main }}
                {{ $isActive := false }}
                {{ $currentPath := $.Page.RelPermalink }}
                {{ $menuURL := .URL }}
                {{/* Build the correct URL */}}
                {{ $href := "" }}
                {{ if hasPrefix .URL "#" }}
                    {{/* Hash link - prepend home URL */}}
                    {{ $href = printf "%s%s" ("/" | relLangURL) .URL }}
                {{ else if hasPrefix .URL "/" }}
                    {{/* Absolute path - use relLangURL */}}
                    {{ $href = .URL | relLangURL }}
                {{ else }}
                    {{/* Relative or external URL */}}
                    {{ $href = .URL }}
                {{ end }}
                {{/* Check if current page matches menu item */}}
                {{ if eq .URL "/" }}
                    {{ $isActive = $.Page.IsHome }}
                {{ else if hasPrefix .URL "#" }}
                    {{ $isActive = $.Page.IsHome }}
                {{ else if hasPrefix .URL "/" }}
                    {{ $isActive = hasPrefix $currentPath (.URL | relLangURL) }}
                {{ end }}
                <li><a href="{{ $href }}" class="nav-link-premium {{ if $isActive }}nav-active{{ end }} {{ if eq .Name "Pricing" }}font-bold{{ end }}">{{ .Name }}</a></li>
                {{ end }}
            </ul>
            
            <!-- Language Switcher (Desktop) -->
            {{ partial "language-switcher.html" . }}
        </nav>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle hamburger-premium" aria-label="{{ i18n "aria_toggle_menu" }}" aria-expanded="false">
            <span class="hamburger-icon">
                <span></span>
                <span></span>
                <span></span>
            </span>
        </button>
    </div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" aria-hidden="true">
        <nav aria-label="Mobile navigation">
            <ul class="mobile-nav-links">
                {{ range site.Menus.main }}
                {{ $isActive := false }}
                {{ $currentPath := $.Page.RelPermalink }}
                {{/* Build the correct URL */}}
                {{ $href := "" }}
                {{ if hasPrefix .URL "#" }}
                    {{ $href = printf "%s%s" ("/" | relLangURL) .URL }}
                {{ else if hasPrefix .URL "/" }}
                    {{ $href = .URL | relLangURL }}
                {{ else }}
                    {{ $href = .URL }}
                {{ end }}
                {{/* Check if current page matches menu item */}}
                {{ if eq .URL "/" }}
                    {{ $isActive = $.Page.IsHome }}
                {{ else if hasPrefix .URL "#" }}
                    {{ $isActive = $.Page.IsHome }}
                {{ else if hasPrefix .URL "/" }}
                    {{ $isActive = hasPrefix $currentPath (.URL | relLangURL) }}
                {{ end }}
                <li><a href="{{ $href }}" class="mobile-nav-link-premium {{ if $isActive }}mobile-nav-active{{ end }}">{{ .Name }}</a></li>
                {{ end }}
            </ul>
            
            <!-- Language Switcher (Mobile) -->
            <div class="mobile-lang-switcher">
                {{ range .Site.Home.AllTranslations }}
                <a href="{{ .RelPermalink }}" 
                   class="mobile-lang-option {{ if eq $.Site.Language.Lang .Language.Lang }}active{{ end }}"
                   lang="{{ .Language.Lang }}">
                    {{ .Language.LanguageName }}
                </a>
                {{ end }}
            </div>
        </nav>
    </div>
</header>

<script>
    // Mobile menu toggle functionality
    document.addEventListener('DOMContentLoaded', function () {
        const mobileToggle = document.querySelector('.mobile-menu-toggle');
        const mobileMenu = document.querySelector('.mobile-menu');

        if (mobileToggle && mobileMenu) {
            mobileToggle.addEventListener('click', function () {
                const isExpanded = this.getAttribute('aria-expanded') === 'true';

                // Toggle states
                this.setAttribute('aria-expanded', !isExpanded);
                mobileMenu.setAttribute('aria-hidden', isExpanded);
                mobileMenu.classList.toggle('open');
                
                // Prevent body scroll when menu is open
                document.body.classList.toggle('mobile-menu-open', !isExpanded);
            });

            // Close menu when clicking a link
            const mobileLinks = mobileMenu.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', function () {
                    mobileToggle.setAttribute('aria-expanded', 'false');
                    mobileMenu.setAttribute('aria-hidden', 'true');
                    mobileMenu.classList.remove('open');
                    document.body.classList.remove('mobile-menu-open');
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                const isClickInside = mobileMenu.contains(event.target) || mobileToggle.contains(event.target);
                const isMenuOpen = mobileMenu.classList.contains('open');
                
                if (!isClickInside && isMenuOpen) {
                    mobileToggle.setAttribute('aria-expanded', 'false');
                    mobileMenu.setAttribute('aria-hidden', 'true');
                    mobileMenu.classList.remove('open');
                    document.body.classList.remove('mobile-menu-open');
                }
            });
        }
    });
</script>
