<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Bar Transitions Test</title>
    <link rel="stylesheet" href="/css/app-bar.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 80px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1a1a2e;
            margin-bottom: 1rem;
        }

        h2 {
            color: #496BC1;
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #496BC1;
            padding-bottom: 0.5rem;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .test-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 200ms ease;
        }

        .btn-primary {
            background: #496BC1;
            color: white;
        }

        .btn-primary:hover {
            background: #3a5aa0;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .test-info {
            background: #e7f3ff;
            border-left: 4px solid #496BC1;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .test-results {
            margin-top: 1rem;
        }

        .test-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .test-item.pass {
            border-left: 4px solid #28a745;
        }

        .test-item.fail {
            border-left: 4px solid #dc3545;
        }

        .test-item.pending {
            border-left: 4px solid #ffc107;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-pass {
            background: #d4edda;
            color: #155724;
        }

        .status-fail {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .computed-values {
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin-top: 1rem;
        }

        .computed-values pre {
            margin: 0;
        }

        .fps-monitor {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            z-index: 300;
        }

        .fps-value {
            font-size: 2rem;
            font-weight: bold;
            color: #28a745;
        }

        .fps-value.warning {
            color: #ffc107;
        }

        .fps-value.error {
            color: #dc3545;
        }

        code {
            background: #f4f4f4;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- App Bar (from header.html) -->
    <header id="app-bar" class="app-bar app-bar-cloud" role="banner">
        <div class="progress-indicator" aria-hidden="true"></div>
        
        <div class="app-bar-container">
            <a href="/" class="app-bar-logo" aria-label="Baseet Studio Home">
                <span class="logo-text">Baseet Studio</span>
            </a>
            
            <nav class="app-bar-nav" aria-label="Main navigation">
                <ul class="nav-links">
                    <li><a href="#features">Features</a></li>
                    <li><a href="#team">Team</a></li>
                    <li><a href="#clients">Clients</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
            
            <button class="mobile-menu-toggle" 
                    aria-label="Toggle navigation menu"
                    aria-expanded="false">
                <span class="hamburger-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </button>
        </div>
        
        <div class="mobile-menu" aria-hidden="true">
            <nav aria-label="Mobile navigation">
                <ul class="mobile-nav-links">
                    <li><a href="#features">Features</a></li>
                    <li><a href="#team">Team</a></li>
                    <li><a href="#clients">Clients</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- FPS Monitor -->
    <div class="fps-monitor">
        <div>FPS: <span class="fps-value" id="fps-value">--</span></div>
        <div>Frame Time: <span id="frame-time">--</span>ms</div>
        <div>Status: <span id="fps-status">Idle</span></div>
    </div>

    <div class="test-container">
        <h1>ðŸ§ª App Bar Transitions Test Suite</h1>
        <p>This page tests all app bar visibility and transition requirements.</p>

        <!-- Task 7.1: Cloud Mode Styling -->
        <h2>Task 7.1: Cloud Mode Styling</h2>
        <div class="test-section">
            <div class="test-info">
                <strong>Requirements:</strong> 1.1, 1.2, 1.3<br>
                <strong>Expected:</strong> 30% opacity, white text, transparent background, no shadow
            </div>
            
            <div class="test-controls">
                <button class="btn-primary" onclick="setCloudMode()">Set Cloud Mode</button>
                <button class="btn-secondary" onclick="testCloudMode()">Run Cloud Mode Tests</button>
            </div>

            <div class="test-results" id="cloud-mode-results"></div>
            <div class="computed-values" id="cloud-mode-computed"></div>
        </div>

        <!-- Task 7.2: Site Mode Styling -->
        <h2>Task 7.2: Site Mode Styling</h2>
        <div class="test-section">
            <div class="test-info">
                <strong>Requirements:</strong> 1.4, 1.5, 2.4<br>
                <strong>Expected:</strong> 100% opacity, brand colors, white background with blur, subtle shadow
            </div>
            
            <div class="test-controls">
                <button class="btn-primary" onclick="setSiteMode()">Set Site Mode</button>
                <button class="btn-secondary" onclick="testSiteMode()">Run Site Mode Tests</button>
            </div>

            <div class="test-results" id="site-mode-results"></div>
            <div class="computed-values" id="site-mode-computed"></div>
        </div>

        <!-- Task 7.3: Transition Smoothness -->
        <h2>Task 7.3: Transition Smoothness</h2>
        <div class="test-section">
            <div class="test-info">
                <strong>Requirements:</strong> 2.1, 2.2, 2.3, 2.5, 3.1, 3.2, 3.3, 3.5, 10.1<br>
                <strong>Expected:</strong> 600ms duration, cubic-bezier easing, 60fps
            </div>
            
            <div class="test-controls">
                <button class="btn-primary" onclick="testTransition('cloud-to-site')">Test Cloud â†’ Site</button>
                <button class="btn-primary" onclick="testTransition('site-to-cloud')">Test Site â†’ Cloud</button>
                <button class="btn-success" onclick="testTransitionLoop()">Run Continuous Loop</button>
                <button class="btn-secondary" onclick="stopTransitionLoop()">Stop Loop</button>
            </div>

            <div class="test-results" id="transition-results"></div>
            <div class="computed-values" id="transition-computed"></div>
        </div>

        <!-- Summary -->
        <h2>Test Summary</h2>
        <div class="test-section">
            <div id="test-summary">
                <p>Run tests to see results...</p>
            </div>
        </div>
    </div>

    <script type="module">
        // Test state
        let transitionLoopInterval = null;
        let fpsMonitor = null;
        let testResults = {
            cloudMode: {},
            siteMode: {},
            transitions: {}
        };

        // Get app bar element
        const appBar = document.getElementById('app-bar');

        // FPS Monitor
        class FPSMonitor {
            constructor() {
                this.fps = 0;
                this.frameTime = 0;
                this.frames = [];
                this.lastTime = performance.now();
                this.isMonitoring = false;
            }

            start() {
                this.isMonitoring = true;
                this.frames = [];
                this.measure();
            }

            stop() {
                this.isMonitoring = false;
            }

            measure() {
                if (!this.isMonitoring) return;

                const now = performance.now();
                const delta = now - this.lastTime;
                this.lastTime = now;

                this.frames.push(delta);
                if (this.frames.length > 60) {
                    this.frames.shift();
                }

                const avgFrameTime = this.frames.reduce((a, b) => a + b, 0) / this.frames.length;
                this.fps = Math.round(1000 / avgFrameTime);
                this.frameTime = avgFrameTime.toFixed(2);

                this.updateDisplay();
                requestAnimationFrame(() => this.measure());
            }

            updateDisplay() {
                const fpsValue = document.getElementById('fps-value');
                const frameTime = document.getElementById('frame-time');
                const fpsStatus = document.getElementById('fps-status');

                fpsValue.textContent = this.fps;
                frameTime.textContent = this.frameTime;

                if (this.fps >= 55) {
                    fpsValue.className = 'fps-value';
                    fpsStatus.textContent = 'Excellent';
                } else if (this.fps >= 45) {
                    fpsValue.className = 'fps-value warning';
                    fpsStatus.textContent = 'Good';
                } else {
                    fpsValue.className = 'fps-value error';
                    fpsStatus.textContent = 'Poor';
                }
            }

            getAverageFPS() {
                return this.fps;
            }
        }

        fpsMonitor = new FPSMonitor();

        // Helper: Get computed styles
        function getComputedStyles(element) {
            return window.getComputedStyle(element);
        }

        // Helper: Parse opacity
        function parseOpacity(value) {
            return parseFloat(value);
        }

        // Helper: Check if color is white
        function isWhiteColor(color) {
            // Convert rgb(255, 255, 255) or #ffffff to check
            const rgb = color.match(/\d+/g);
            if (rgb) {
                return rgb[0] === '255' && rgb[1] === '255' && rgb[2] === '255';
            }
            return false;
        }

        // Helper: Check if background is transparent
        function isTransparent(bg) {
            return bg === 'rgba(0, 0, 0, 0)' || bg === 'transparent';
        }

        // Helper: Check if shadow exists
        function hasShadow(shadow) {
            return shadow !== 'none' && shadow !== '';
        }

        // Helper: Display test results
        function displayResults(containerId, results) {
            const container = document.getElementById(containerId);
            container.innerHTML = results.map(result => `
                <div class="test-item ${result.status}">
                    <span>${result.name}</span>
                    <span class="status-badge status-${result.status}">${result.status.toUpperCase()}</span>
                </div>
            `).join('');
        }

        // Helper: Display computed values
        function displayComputed(containerId, values) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<pre>${JSON.stringify(values, null, 2)}</pre>`;
        }

        // Set Cloud Mode
        window.setCloudMode = function() {
            appBar.classList.remove('app-bar-site');
            appBar.classList.add('app-bar-cloud');
            console.log('Set to Cloud Mode');
        };

        // Set Site Mode
        window.setSiteMode = function() {
            appBar.classList.remove('app-bar-cloud');
            appBar.classList.add('app-bar-site');
            console.log('Set to Site Mode');
        };

        // Test Cloud Mode (Task 7.1)
        window.testCloudMode = function() {
            setCloudMode();
            
            // Wait for styles to apply
            setTimeout(() => {
                const styles = getComputedStyles(appBar);
                const logoText = appBar.querySelector('.logo-text');
                const logoStyles = getComputedStyles(logoText);
                const navLink = appBar.querySelector('.nav-links a');
                const navStyles = getComputedStyles(navLink);

                const opacity = parseOpacity(styles.opacity);
                const bgColor = styles.backgroundColor;
                const shadow = styles.boxShadow;
                const logoColor = logoStyles.color;
                const navColor = navStyles.color;

                const results = [
                    {
                        name: 'Opacity is 0.3 (30%)',
                        status: Math.abs(opacity - 0.3) < 0.01 ? 'pass' : 'fail'
                    },
                    {
                        name: 'Logo text is white',
                        status: isWhiteColor(logoColor) ? 'pass' : 'fail'
                    },
                    {
                        name: 'Nav links are white',
                        status: isWhiteColor(navColor) ? 'pass' : 'fail'
                    },
                    {
                        name: 'Background is transparent',
                        status: isTransparent(bgColor) ? 'pass' : 'fail'
                    },
                    {
                        name: 'No shadow',
                        status: !hasShadow(shadow) ? 'pass' : 'fail'
                    }
                ];

                testResults.cloudMode = results;
                displayResults('cloud-mode-results', results);
                displayComputed('cloud-mode-computed', {
                    opacity,
                    backgroundColor: bgColor,
                    boxShadow: shadow,
                    logoColor,
                    navColor
                });

                updateSummary();
            }, 100);
        };

        // Test Site Mode (Task 7.2)
        window.testSiteMode = function() {
            setSiteMode();
            
            // Wait for styles to apply
            setTimeout(() => {
                const styles = getComputedStyles(appBar);
                const logoText = appBar.querySelector('.logo-text');
                const logoStyles = getComputedStyles(logoText);
                const navLink = appBar.querySelector('.nav-links a');
                const navStyles = getComputedStyles(navLink);

                const opacity = parseOpacity(styles.opacity);
                const bgColor = styles.backgroundColor;
                const shadow = styles.boxShadow;
                const logoColor = logoStyles.color;
                const navColor = navStyles.color;
                const backdropFilter = styles.backdropFilter || styles.webkitBackdropFilter;

                const results = [
                    {
                        name: 'Opacity is 1.0 (100%)',
                        status: Math.abs(opacity - 1.0) < 0.01 ? 'pass' : 'fail'
                    },
                    {
                        name: 'Logo has brand color (#496BC1)',
                        status: logoColor.includes('73') && logoColor.includes('107') && logoColor.includes('193') ? 'pass' : 'fail'
                    },
                    {
                        name: 'Nav links have dark color',
                        status: !isWhiteColor(navColor) ? 'pass' : 'fail'
                    },
                    {
                        name: 'Background is white/semi-transparent',
                        status: bgColor.includes('255') ? 'pass' : 'fail'
                    },
                    {
                        name: 'Has backdrop blur',
                        status: backdropFilter && backdropFilter !== 'none' ? 'pass' : 'fail'
                    },
                    {
                        name: 'Has shadow',
                        status: hasShadow(shadow) ? 'pass' : 'fail'
                    }
                ];

                testResults.siteMode = results;
                displayResults('site-mode-results', results);
                displayComputed('site-mode-computed', {
                    opacity,
                    backgroundColor: bgColor,
                    boxShadow: shadow,
                    backdropFilter,
                    logoColor,
                    navColor
                });

                updateSummary();
            }, 100);
        };

        // Test Transition (Task 7.3)
        window.testTransition = function(direction) {
            const styles = getComputedStyles(appBar);
            const transition = styles.transition;

            // Check transition properties
            const has600ms = transition.includes('600ms');
            const hasCubicBezier = transition.includes('cubic-bezier');
            const hasOpacity = transition.includes('opacity');
            const hasBackground = transition.includes('background');

            const results = [
                {
                    name: 'Has 600ms duration',
                    status: has600ms ? 'pass' : 'fail'
                },
                {
                    name: 'Uses cubic-bezier easing',
                    status: hasCubicBezier ? 'pass' : 'fail'
                },
                {
                    name: 'Transitions opacity',
                    status: hasOpacity ? 'pass' : 'fail'
                },
                {
                    name: 'Transitions background',
                    status: hasBackground ? 'pass' : 'fail'
                }
            ];

            // Start FPS monitoring
            fpsMonitor.start();
            document.getElementById('fps-status').textContent = 'Monitoring...';

            // Trigger transition
            if (direction === 'cloud-to-site') {
                setCloudMode();
                setTimeout(() => setSiteMode(), 100);
            } else {
                setSiteMode();
                setTimeout(() => setCloudMode(), 100);
            }

            // Stop monitoring after transition
            setTimeout(() => {
                const avgFPS = fpsMonitor.getAverageFPS();
                fpsMonitor.stop();

                results.push({
                    name: `Average FPS: ${avgFPS} (target: 60)`,
                    status: avgFPS >= 55 ? 'pass' : avgFPS >= 45 ? 'pending' : 'fail'
                });

                testResults.transitions = results;
                displayResults('transition-results', results);
                displayComputed('transition-computed', {
                    transition,
                    averageFPS: avgFPS,
                    direction
                });

                updateSummary();
            }, 700);
        };

        // Test Transition Loop
        window.testTransitionLoop = function() {
            let isCloud = true;
            fpsMonitor.start();
            
            transitionLoopInterval = setInterval(() => {
                if (isCloud) {
                    setSiteMode();
                } else {
                    setCloudMode();
                }
                isCloud = !isCloud;
            }, 1500);

            document.getElementById('fps-status').textContent = 'Loop Running...';
        };

        // Stop Transition Loop
        window.stopTransitionLoop = function() {
            if (transitionLoopInterval) {
                clearInterval(transitionLoopInterval);
                transitionLoopInterval = null;
            }
            fpsMonitor.stop();
            document.getElementById('fps-status').textContent = 'Stopped';
        };

        // Update Summary
        function updateSummary() {
            const summary = document.getElementById('test-summary');
            let totalTests = 0;
            let passedTests = 0;

            Object.values(testResults).forEach(category => {
                if (Array.isArray(category)) {
                    category.forEach(test => {
                        totalTests++;
                        if (test.status === 'pass') passedTests++;
                    });
                }
            });

            const percentage = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;

            summary.innerHTML = `
                <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 1rem;">
                    ${passedTests} / ${totalTests} tests passed (${percentage}%)
                </div>
                <div style="background: #e7f3ff; padding: 1rem; border-radius: 4px;">
                    <strong>Cloud Mode:</strong> ${testResults.cloudMode.length || 0} tests<br>
                    <strong>Site Mode:</strong> ${testResults.siteMode.length || 0} tests<br>
                    <strong>Transitions:</strong> ${testResults.transitions.length || 0} tests
                </div>
            `;
        }

        // Initialize
        console.log('App Bar Transitions Test Suite loaded');
        console.log('Use the buttons to run tests');
    </script>
</body>
</html>
